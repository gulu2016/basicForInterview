### 多线程
 
多线程的面试问题：[参考博客](https://www.cnblogs.com/dolphin0520/p/3958019.html)


#### 基础知识

- 以下问题参考此博客[参考博客](https://www.cnblogs.com/dolphin0520/p/3920373.html)

1.缓存一致性协议和总线锁机制
  - 出现原因：多个cpu操作共享变量会出现数据一致性问题
  - 缓存一致性协议：某个cpu向缓存写入数据时候，同时通知其他缓存中的数据无效，这样其他缓存读取数据的时候就会从
  内存中重新读取。
  - 总线锁：如果在执行这段代码的过程中，在总线上发出了LCOK#锁的信号，那么只有等待这段代码完全执行完毕之后，
  其他CPU才能从变量i所在的内存读取变量，但是这样效率会很低下。
  - ![参考图片](https://images0.cnblogs.com/blog/288799/201408/212219343783699.jpg)
  
2.并发编程中三个概念
  - 原子性：即一个操作或者多个操作 要么全部执行并且执行的过程不会被任何因素打断，要么就都不执行。
  - 可见性:是指当多个线程访问同一个变量时，一个线程修改了这个变量的值，其他线程能够立即看得到修改的值。
  - 有序性：即程序执行的顺序按照代码的先后顺序执行。
  - (要想并发程序正确地执行，必须要保证原子性、可见性以及有序性。只要有一个没有被保证，就有可能会导致程序运行不正确。)

3.Java语言对原子性、可见性以及有序性提供了哪些保证
  - 对原子性的操作：对基本数据类型的变量的读取和赋值操作是原子性操作（参看博客中例子）
  - 对于可见性，Java提供了volatile关键字来保证可见性。
    当一个共享变量被volatile修饰时，它会保证修改的值会立即被更新到主存，
  当有其他线程需要读取时，它会去内存中读取新值。
  - 对于有序性：
    由happens-before原则保证：如果两个操作的执行次序无法从happens-before原则推导出来，
  那么它们就不能保证它们的有序性，虚拟机可以随意地对它们进行重排序。
    四条较重要的happens-before原则
    (1)程序次序规则：一个线程内，按照代码顺序，书写在前面的操作先行发生于书写在后面的操作
    (2)锁定规则：一个unLock操作先行发生于后面对同一个锁额lock操作
    (3)volatile变量规则：对一个变量的写操作先行发生于后面对这个变量的读操作
    (4)传递规则：如果操作A先行发生于操作B，而操作B又先行发生于操作C，则可以得出操作A先行发生于操作C
    
4.volatile关键字
  - 一旦一个共享变量（类的成员变量、类的静态成员变量）被volatile修饰之后，那么就具备了两层语义：
      >1）保证了不同线程对这个变量进行操作时的可见性，即一个线程修改了某个变量的值，
      这新值对其他线程来说是立即可见的。
      >2）禁止进行指令重排序。
  - volatile保证多线程可见性：多线程使用volatile关键字发生了什么
      > （1）线程1修改值（2）volatile强制将修改的值立即写入主存（3）线程2缓存变量无效
      （4）线程2重新读取变量
  - volatile不能保证对变量的操作是原子性
      > (1)线程1先读取了变量inc的原始值，被阻塞
        (2)线程2对变量进行自增操作
        (3)虽然此时线程2写入数据让线程1的数据无效，但是线程1已经读取过数据，并没有重新读取数据
        这样再进行增，得到和线程2同样的结果
        (4)两个线程执行自增最后加1
  - volatile能在一定程度上保证有序性
      > volatile变量是一个分隔符，执行到此的时候前边的指令一定执行结束，后边的指令一定还没有执行
      
5.使用volatile的场景
  - 状态标记量 
  - 单例模式中的double check（具体参考博客）
    

1.volatile怎么保证可见性，synchronized和lock的区别，synchronized的底层实现
 
2.sleep和wait的区别，sleep会不会释放锁，notify和notifyAll的区别 

3.了不了解线程的局部变量，讲讲线程池参数 

4.什么情况会发生死锁，死锁的处理方法 

5.volatile和synchronized的区别 

6.synchronized的底层实现 

7.线程等待时位于哪个区域，具体讲一下
 
8.java实现多线程的方式 

9.进程和线程，Java实现多线程的方式，什么是线程安全，怎么保证多线程线程安全

10.可重入锁的可重入性是什么意思，哪些是可重入锁

11.为什么要用线程池，线程池的好处

12.高并发怎么处理（没有回答上来）

13.线程池的参数